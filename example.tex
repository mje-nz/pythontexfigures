\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}

\usepackage{pgf}
\usepackage{subfig}

% Make build reproducible
% https://tex.stackexchange.com/a/5961
% https://tex.stackexchange.com/a/313605
\pdfinfo{ /Producer (pdfTeX) }
\pdfinfoomitdate=1
\pdftrailerid{}
\pdfsuppressptexinfo=-1

\usepackage[gobble=auto,keeptemps=all]{pythontex}

% Pass font size, text width, and PythonTeX output dir into scripts
% https://tex.stackexchange.com/a/409993
\makeatletter
\newcommand*\fsize{\dimexpr\f@size pt\relax}
\newcommand*\pytxoutputdir{\pytx@outputdir}
\makeatother

\setpythontexcontext{fontsize=\the\fsize,textwidth=\the\textwidth,outputdir=\pytxoutputdir}

% Pass context into customcode environment
% https://github.com/gpoore/pythontex/issues/65
\makeatletter
\renewenvironment{pythontexcustomcode}[2][begin]{%
    \VerbatimEnvironment
    \Depythontex{env:pythontexcustomcode:om:n}%
    %! Suppress = NonMatchingIf
    \ifstrequal{#1}{begin}{}{%
        \ifstrequal{#1}{end}{}{\PackageError{\pytx@packagename}%
            {Invalid optional argument for pythontexcustomcode}{}
        }%
    }%
    \xdef\pytx@type{CC:#2:#1}%
    \edef\pytx@cmd{code}%
    % PATCH \def\pytx@context{}%
    \pytx@SetContext
    % END PATCH
    \def\pytx@group{none}%
    \pytx@BeginCodeEnv[none]}%
{\end{VerbatimOut}%
    \setcounter{FancyVerbLine}{\value{pytx@FancyVerbLineTemp}}%
    \stepcounter{\pytx@counter}%
}%
\makeatother

% Shorthand for inserting figures from Python scripts
\newcommand*{\pyfig}[1]{\py{pf.figure(#1)}}


\begin{pythontexcustomcode}[begin]{py}
	# Set up python_figures first so it can configure matplotlib
	import python_figures as pf
	pf.setup(pytex)

	# Set up environment for scripts
	import numpy as np
	import matplotlib.pyplot as plt
	import seaborn as sns
	sns.set_style('white')
\end{pythontexcustomcode}


\begin{document}
	\title{Latex Python figure examples}
	\author{Matthew Edwards}
	\date{July 2019}
	\maketitle

	\begin{figure}[h]
		\pyfig{'test.py'}
		\caption{Test Python figure.}
		\label{fig:test}
	\end{figure}

	\begin{figure}
		\centering
		\subfloat[Test figure (golden aspect ratio).]{%
			\pyfig{'test.py', width=0.45*pf.TEXT_WIDTH, aspect=pf.GOLDEN}
		}
		\subfloat[Test figure (square aspect ratio).]{%
			\pyfig{'test.py', width=0.45*pf.TEXT_WIDTH}
		}
		\caption{Side-by-side Python figures.}
		\label{fig:test2}
	\end{figure}
\end{document}
